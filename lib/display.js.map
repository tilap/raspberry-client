{"version":3,"sources":["../src/display.js"],"names":[],"mappings":";;;;;QAMgB;QAKA;QAgBA;QAsCA;QAMA;;;;;;;;AAnEhB,MAAM,SAAS,+BAAkB,aAAlB,EAAiC,sBAAS,IAAT,CAA1C;;;;EAEC,SAAS,OAAT,GAAmB;AACtB,UAAM,SAAS,kBAAT,CADgB;AAEtB,WAAO,wBAAU,CAAC,EAAD,GAAK,OAAO,OAAP,EAAe,GAApB,CAAV,EAAoC,CAAC,SAAD,CAApC,CAAP,CAFsB;CAAnB;;;;EAKA,SAAS,MAAT,GAAkB;AACrB,UAAM,SAAS,kBAAT,CADe;AAErB,QAAI,OAAO,OAAP,KAAmB,OAAnB,EAA4B;AAC5B,eAAO,wBAAU,CAAC,EAAD,GAAK,OAAO,OAAP,EAAe,GAApB,CAAV,EAAoC,CAAC,MAAD,EAAS,OAAO,GAAP,CAA7C,CAAP,CAD4B;KAAhC,MAEO;AACH,eAAO,SAAP,CADG;KAFP;CAFG;;;;EASP,SAAS,UAAT,GAAsB;AAClB,WAAO,wBAAU,cAAV,EAA0B,CAAC,OAAD,CAA1B,CAAP,CADkB;CAAtB;;AAIA,IAAI,WAAJ;AACA,IAAI,YAAJ;;;;EAEO,SAAS,KAAT,GAAiB;AACpB,QAAI,iBAAiB,SAAjB,EAA4B;AAC5B,eAAO,IAAP,CAAY,yBAAZ,EAD4B;AAE5B,eAF4B;KAAhC;;AAKA,QAAI,YAAJ,EAAkB;AACd,eAAO,IAAP,CAAY,wBAAZ,EADc;AAEd,eAFc;KAAlB;;AAKA,WAAO,IAAP,CAAY,aAAZ,EAXoB;AAYpB,kBAAc,IAAd,CAZoB;;AAcpB,UAAM,SAAS,kBAAT,CAdc;;AAgBpB,QAAI,CAAC,cAAD,EAAiB,OAAjB,EAA0B,UAA1B,EAAsC,SAAtC,EAAiD,OAAjD,CAAyD,OAAO,OAAP,CAAzD,KAA6E,CAAC,CAAD,EAAI;AACjF,eAAO,OAAP,GAAiB,SAAjB,CADiF;KAArF;;AAIA,QAAI,SAAS,OAAO,OAAP,CApBO;AAqBpB,QAAI,WAAW,SAAX,EAAsB;AACtB,iBAAS,OAAT,CADsB;KAA1B;;AAIA,WAAO,IAAP,CAAY,OAAZ,EAAqB,EAAE,MAAF,EAAU,KAAK,OAAO,GAAP,EAApC,EAzBoB;AA0BpB,mBAAe,oBAAM,CAAC,EAAD,GAAK,MAAL,EAAY,GAAZ,CAAN,EAAwB,CAAC,OAAD,EAAU,OAAO,GAAP,CAAlC,CAAf,CA1BoB;AA2BpB,iBAAa,MAAb,CAAoB,EAApB,CAAuB,MAAvB,EAA+B,QAAQ,OAAO,KAAP,CAAa,KAAK,QAAL,EAAb,CAAR,CAA/B,CA3BoB;AA4BpB,iBAAa,MAAb,CAAoB,EAApB,CAAuB,MAAvB,EAA+B,QAAQ,OAAO,KAAP,CAAa,KAAK,QAAL,EAAb,CAAR,CAA/B,CA5BoB;AA6BpB,iBAAa,EAAb,CAAgB,OAAhB,EAAyB,QAAQ;AAC7B,uBAAe,IAAf,CAD6B;AAE7B,eAAO,KAAP,CAAa,CAAC,+BAAD,GAAkC,IAAlC,EAAuC,CAApD,EAF6B;AAG7B,YAAI,WAAJ,EAAiB;AACb,oBAAQ,QAAR,CAAiB,MAAM,OAAN,CAAjB,CADa;SAAjB;KAHqB,CAAzB,CA7BoB;CAAjB;;;;EAsCA,SAAS,OAAT,GAAmB;AACtB,WAAO,IAAP,CAAY,eAAZ,EADsB;AAEtB,WAFsB;AAGtB,WAAO,OAAP,CAHsB;CAAnB;;;;EAMA,SAAS,IAAT,GAAgB;AACnB,kBAAc,KAAd,CADmB;AAEnB,mBAAe,IAAf,CAFmB;AAGnB,iBAAa,kBAAb,GAHmB;AAInB,4BAAU,CAAC,YAAD,CAAV,EAA0B,CAAC,MAAD,CAA1B,EAJmB;CAAhB","file":"display.js","sourcesContent":["import { ConsoleLogger, LogLevel } from 'nightingale';\nimport { get as getConfig } from './config';\nimport { runScript, spawn } from './scripts';\n\nconst logger = new ConsoleLogger('app.display', LogLevel.INFO);\n\nexport function refresh() {\n    const config = getConfig();\n    return runScript(`./${config.display}.sh`, ['refresh']);\n}\n\nexport function update() {\n    const config = getConfig();\n    if (config.display === 'kweb3') {\n        return runScript(`./${config.display}.sh`, ['load', config.url]);\n    } else {\n        return restart();\n    }\n}\n\nfunction runOpenBox() {\n    return runScript('./openbox.sh', ['start']);\n}\n\nlet autoRestart;\nlet childProcess;\n\nexport function start() {\n    if (runOpenBox() !== 'started') {\n        logger.warn('openbox not yet started');\n        return;\n    }\n\n    if (childProcess) {\n        logger.warn('start: already started');\n        return;\n    }\n\n    logger.info('starting...');\n    autoRestart = true;\n\n    const config = getConfig();\n\n    if (['livestreamer', 'kweb3', 'chromium', 'browser'].indexOf(config.display) === -1) {\n        config.display = 'browser';\n    }\n\n    let script = config.display;\n    if (script === 'browser') {\n        script = 'kweb3';\n    }\n\n    logger.info('start', { script, url: config.url });\n    childProcess = spawn(`./${script}.sh`, ['start', config.url]);\n    childProcess.stdout.on('data', data => logger.debug(data.toString()));\n    childProcess.stderr.on('data', data => logger.error(data.toString()));\n    childProcess.on('close', code => {\n        childProcess = null;\n        logger.error(`child process exited with code ${code}`);\n        if (autoRestart) {\n            process.nextTick(() => start());\n        }\n    });\n}\n\nexport function restart() {\n    logger.info('restarting...');\n    stop();\n    return start();\n}\n\nexport function stop() {\n    autoRestart = false;\n    childProcess = null;\n    childProcess.removeAllListeners();\n    runScript(`./display.sh`, ['stop']);\n}\n"]}