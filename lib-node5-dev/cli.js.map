{"version":3,"sources":["../src/cli.js"],"names":[],"mappings":";;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,8BAAe,EAAE,sBAAF,EAAf,EAAwB,MAAxB,G;;;AAEA,IAAI,uBAAK,OAAT,EAAkB;AACd,YAAQ,GAAR,CAAY,kBAAI,OAAhB;AACA,YAAQ,IAAR,CAAa,CAAb;AACH;;AAED,IAAI,CAAC,uBAAK,CAAL,CAAO,CAAP,CAAD,IAAc,uBAAK,IAAvB,EAA6B;AACzB,YAAQ,GAAR,CAAY,4BAAZ;AACA,YAAQ,GAAR,CAAY,UAAZ;AACA,YAAQ,GAAR,CAAY,iBAAZ;AACA,YAAQ,GAAR,CAAY,YAAZ;AACA,YAAQ,GAAR,CAAY,8BAAZ;AACA,YAAQ,GAAR,CAAY,gCAAZ;AACA,YAAQ,GAAR,CAAY,sDAAZ;AACA,YAAQ,GAAR,CAAY,aAAZ;AACA,YAAQ,GAAR,CAAY,mEAAZ;AACA,YAAQ,GAAR,CAAY,+DAAZ;AACA,YAAQ,GAAR,CAAY,uDAAZ;AACA,YAAQ,IAAR,CAAa,CAAb;AACH;;AAED,MAAM,SAAS,0BAAW,KAAX,CAAf;;AAEA,MAAM,SAAS,iBAAf;AACA,MAAM,aAAa,gCAAa,MAAb,CAAnB;;AAEA,WAAW,EAAX,CAAc,OAAd,EAAuB,OAAO;AAC1B,WAAO,KAAP,CAAa,GAAb;AACH,CAFD;;AAIA,OAAO,EAAP,CAAU,OAAV,EAAmB,OAAO;AACtB,WAAO,KAAP,CAAa,GAAb;AACH,CAFD;;AAIA,OAAO,EAAP,CAAU,KAAV,EAAiB,MAAM;AACnB,WAAO,KAAP,CAAa,cAAb;AACA,eAAW,GAAX;AACH,CAHD;;AAMA,OAAO,EAAP,CAAU,SAAV,EAAqB,MAAM;AACvB,WAAO,KAAP,CAAa,WAAb;;AAEA,eAAW,KAAX;AACH,CAJD;;AAMA,WAAW,EAAX,CAAc,MAAd,EAAsB,QAAQ;AAC1B,QAAI,KAAK,IAAL,KAAc,MAAlB,EAA0B;AACtB,gBAAQ,GAAR,CAAY,KAAK,MAAjB;AACA,eAAO,GAAP;AACH,KAHD,MAGO,IAAI,KAAK,KAAT,EAAgB;AACnB,gBAAQ,GAAR,CAAY,KAAK,KAAjB;AACA,eAAO,GAAP;AACH,KAHM,MAGA;AACH,gBAAQ,GAAR,CAAY,IAAZ;AACH;AACJ,CAVD;;AAaA,MAAM,aAAa,CAAC,AAAD,GAAG,iBAAH,EAAY,iBAAZ,CAAnB;AACA,OAAO,OAAP,CAAe,UAAf","file":"cli.js","sourcesContent":["/* eslint-disable no-console */\nimport { Socket } from 'net';\nimport { tmpDir } from 'os';\nimport Logger from 'nightingale';\nimport updateNotifier from 'update-notifier';\nimport argv from 'minimist-argv';\nimport pkg from '../package.json';\nimport { createStream } from 'objectstream';\n\nupdateNotifier({ pkg }).notify();\n\nif (argv.version) {\n    console.log(pkg.version);\n    process.exit(0);\n}\n\nif (!argv._[0] || argv.help) {\n    console.log('Usage: cli <action> [args]');\n    console.log('actions:');\n    console.log('  - self-update');\n    console.log('  - screen');\n    console.log('      on: turn the screen on');\n    console.log('      off: turn the screen off');\n    console.log('      state: display the current state of the screen');\n    console.log('  - display');\n    console.log('      restart: restart the current display (kweb3 / twitch / ...)');\n    console.log('      refresh: refresh the browser (only for kweb3/chromimum)');\n    console.log('      openbox-started: notify that openbox is started');\n    process.exit(0);\n}\n\nconst logger = new Logger('cli');\n\nconst socket = new Socket();\nconst jsonStream = createStream(socket);\n\njsonStream.on('error', err => {\n    logger.error(err);\n});\n\nsocket.on('error', err => {\n    logger.error(err);\n});\n\nsocket.on('end', () => {\n    logger.debug('socket ended');\n    jsonStream.end();\n});\n\n\nsocket.on('connect', () => {\n    logger.debug('connected');\n\n    jsonStream.write(argv);\n});\n\njsonStream.on('data', data => {\n    if (data.type === 'done') {\n        console.log(data.result);\n        socket.end();\n    } else if (data.error) {\n        console.log(data.error);\n        socket.end();\n    } else {\n        console.log(data);\n    }\n});\n\n\nconst socketPath = `${tmpDir()}/raspberry-client`;\nsocket.connect(socketPath);\n"]}