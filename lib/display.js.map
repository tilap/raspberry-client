{"version":3,"sources":["../src/display.js"],"names":[],"mappings":";;;;;QAMgB;QAIA;QAOA;QAsBA;QAMA;;;;;;;;AAzChB,MAAM,SAAS,+BAAkB,aAAlB,EAAiC,sBAAS,IAAT,CAA1C;;;;EAEC,SAAS,OAAT,GAAmB;AACtB,WAAO,wBAAU,cAAV,EAA0B,CAAC,SAAD,CAA1B,CAAP,CADsB;CAAnB;;;;EAIA,SAAS,MAAT,GAAkB;AACrB,WAAO,wBAAU,cAAV,EAA0B,CAAC,MAAD,EAAS,mBAAY,GAAZ,CAAnC,CAAP,CADqB;CAAlB;;AAIP,IAAI,WAAJ;AACA,IAAI,YAAJ;;;;EAEO,SAAS,KAAT,GAAiB;AACpB,QAAI,YAAJ,EAAkB;AACd,eADc;KAAlB;;AAIA,WAAO,IAAP,CAAY,eAAZ,EALoB;AAMpB,kBAAc,IAAd,CANoB;;AAQpB,UAAM,SAAS,kBAAT,CARc;AASpB,UAAM,SAAS,OAAO,OAAP,KAAmB,cAAnB,GAAoC,cAApC,GAAqD,SAArD,CATK;AAUpB,mBAAe,oBAAM,CAAC,EAAD,GAAK,MAAL,EAAY,GAAZ,CAAN,EAAwB,CAAC,OAAD,EAAU,OAAO,GAAP,CAAlC,CAAf,CAVoB;AAWpB,iBAAa,MAAb,CAAoB,EAApB,CAAuB,MAAvB,EAA+B,QAAQ,OAAO,KAAP,CAAa,KAAK,QAAL,EAAb,CAAR,CAA/B,CAXoB;AAYpB,iBAAa,MAAb,CAAoB,EAApB,CAAuB,MAAvB,EAA+B,QAAQ,OAAO,KAAP,CAAa,KAAK,QAAL,EAAb,CAAR,CAA/B,CAZoB;AAapB,iBAAa,EAAb,CAAgB,OAAhB,EAAyB,QAAQ;AAC7B,uBAAe,IAAf,CAD6B;AAE7B,eAAO,KAAP,CAAa,CAAC,+BAAD,GAAkC,IAAlC,EAAuC,CAApD,EAF6B;AAG7B,YAAI,WAAJ,EAAiB;AACb,oBAAQ,QAAR,CAAiB,MAAM,OAAN,CAAjB,CADa;SAAjB;KAHqB,CAAzB,CAboB;CAAjB;;;;EAsBA,SAAS,OAAT,GAAmB;AACtB,YAAQ,OAAR,CAAgB,MAAhB,EACK,IADL,CACU,MAAM,OAAN,CADV,CADsB;CAAnB;;;;EAMA,SAAS,IAAT,GAAgB;AACnB,WAAO,IAAP,CAAY,cAAZ,EADmB;AAEnB,kBAAc,KAAd,CAFmB;AAGnB,QAAI,YAAJ,EAAkB;AACd,eAAO,IAAI,OAAJ,CAAY,WAAa;AAC5B,yBAAa,IAAb,CAAkB,OAAlB,EAA2B,MAAM,SAAN,CAA3B,CAD4B;AAE5B,yBAAa,IAAb,GAF4B;AAG5B,2BAAe,IAAf,CAH4B;SAAb,CAAnB,CADc;KAAlB;CAHG","file":"display.js","sourcesContent":["import { ConsoleLogger, LogLevel } from 'nightingale';\nimport { get as getConfig } from './config';\nimport { runScript, spawn } from './scripts';\n\nconst logger = new ConsoleLogger('app.display', LogLevel.INFO);\n\nexport function refresh() {\n    return runScript('./browser.sh', ['refresh']);\n}\n\nexport function update() {\n    return runScript('./browser.sh', ['load', getConfig().url]);\n}\n\nlet autoRestart;\nlet childProcess;\n\nexport function start() {\n    if (childProcess) {\n        return;\n    }\n\n    logger.info('start display');\n    autoRestart = true;\n\n    const config = getConfig();\n    const script = config.display === 'livestreamer' ? 'livestreamer' : 'browser';\n    childProcess = spawn(`./${script}.sh`, ['start', config.url]);\n    childProcess.stdout.on('data', data => logger.debug(data.toString()));\n    childProcess.stderr.on('data', data => logger.error(data.toString()));\n    childProcess.on('close', code => {\n        childProcess = null;\n        logger.error(`child process exited with code ${code}`);\n        if (autoRestart) {\n            process.nextTick(() => start());\n        }\n    });\n}\n\nexport function restart() {\n    Promise.resolve(stop())\n        .then(() => start());\n}\n\n\nexport function stop() {\n    logger.info('stop display');\n    autoRestart = false;\n    if (childProcess) {\n        return new Promise((resolve) => {\n            childProcess.once('close', () => resolve());\n            childProcess.kill();\n            childProcess = null;\n        });\n    }\n}\n"]}