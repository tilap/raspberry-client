{"version":3,"sources":["../src/update.js"],"names":[],"mappings":";;;;;QAMgB;;;;;;;;AAFhB,MAAM,SAAS,+BAAkB,YAAlB,EAAgC,sBAAS,IAAT,CAAzC;;;;EAEC,SAAS,UAAT,GAAsB;AACzB,WAAO,IAAP,CAAY,aAAZ,EADyB;AAEzB,QAAI;AACA,sCAAU,KAAV,EAAiB,CAAC,MAAD,CAAjB,EAA2B,EAAE,OAAO,SAAP,EAAkB,KAAK,CAAC,GAAE,SAAH,EAAa,IAAb,CAAL,EAA/C,EADA;AAEA,sCAAU,KAAV,EAAiB,CAAC,SAAD,EAAY,cAAZ,CAAjB,EAA8C,EAAE,OAAO,SAAP,EAAkB,KAAK,CAAC,GAAE,SAAH,EAAa,IAAb,CAAL,EAAlE,EAFA;AAGA,sCAAU,KAAV,EAAiB,CAAC,OAAD,EAAU,cAAV,CAAjB,EAA4C,EAAE,OAAO,SAAP,EAAkB,KAAK,CAAC,GAAE,SAAH,EAAa,IAAb,CAAL,EAAhE,EAHA;AAIA,sCAAU,MAAV,EAAkB,CAAC,eAAD,EAAkB,SAAlB,EAA6B,uBAA7B,CAAlB,EAJA;KAAJ,CAKE,OAAO,GAAP,EAAY;AACV,eAAO,KAAP,CAAa,IAAI,OAAJ,CAAb,CADU;KAAZ;CAPC","file":"update.js","sourcesContent":["import { spawnSync } from 'child_process';\nimport { ConsoleLogger, LogLevel } from 'nightingale';\nimport { runScript } from './scripts';\n\nconst logger = new ConsoleLogger('app.update', LogLevel.INFO);\n\nexport function selfUpdate() {\n    logger.info('self update');\n    try {\n        spawnSync('git', ['pull'], { stdio: 'inherit', cwd: `${__dirname}/../` });\n        spawnSync('npm', ['install', '--production'], { stdio: 'inherit', cwd: `${__dirname}/../` });\n        spawnSync('npm', ['prune', '--production'], { stdio: 'inherit', cwd: `${__dirname}/../` });\n        spawnSync('sudo', ['supervisorctl', 'restart', 'node-raspberry-client']);\n    } catch (err) {\n        logger.error(err.message);\n    }\n}\n"]}